Схема нашей сети:
Центральный роутер микротик ccr2216 в офисе и примерно 100 роутеров Микротик hAP ac2 в каждом филиале, топология у нас звёздочка. Наши требования:
	1. Мониторить состояние туннелей (active/inactive/establishing/failed/not configured)
	2. Централизованное хранение логов, разделить по группам и возможность фильтровать их по уровню необходимости (info/warning/alert/error):
		Логи безопасности: записывают события, связанные с безопасностью, такие как попытки несанкционированного доступа, изменения конфигурации, брутфорс-атаки и т.д. 
		Логи системных событий: содержат информацию о работе системных служб и компонентов, включая загрузку, остановку, ошибки и предупреждения. 
		Логи интерфейсов: Записывают информацию о работе сетевых интерфейсов, включая статус, активность, пропускную способность и ошибки
		<<!гов>>Логи роутинга: Содержат информацию о работе протоколов маршрутизации, включая изменения в таблице маршрутизации, обновления, ошибки и т.д.
		Логи фильтров (firewall): Записывают события, связанные с работой правил брандмауэра, включая принятие, отклонение пакетов, а также другую информацию о фильтрации трафика. 
		Логирование на удаленный сервер: MikroTik позволяет настроить отправку логов на внешний сервер для централизованного хранения и анализа, например, на сервер с Rsyslog.
	3. Для сбора метрик использовать нужные сетевые протоколы, такие как SNMP / NetFlow / IPFIX
		SNMP - для получения информации о различных аспектах маршрутизатора, таких как загрузка процессора, использование памяти, состояние интерфейсов, трафик и многое другое...
		NetFlow (IPFIX) - озволяет собирать подробную информацию о трафике, проходящем через маршрутизатор, включая IP-адреса отправителей и получателей, порты, протоколы и количество передаваемых двнных.
		Настройка NetFlow на Mikrotik RouterOS включает в себя указание IP-адреса и порта коллектора NetFlow, а также настройку экспорта потоков.
		Что мы теряем без Netflow? 
			Нельзя будет точно сказать "вот этот IP качает 80% трафика"
			Не увидим конкретные порты/протоколы(например, что всё уходит на Netflix)
			Не определяем, кто floodит сеть или делает сканирование
			
			
Альтернативы систем мониторинга помимо The Dude:

1. Стек: Zabbix (полный мониторинг) + ELK (логи).
	Плюсы: Автоматическое обнаружение устройств, LLD (Low-Level Discovery) для динамических элементов (например, L2TP-туннелей), кастомизируемые дашборды. Поддерживает сбор данных через SNMP, API, SSH,
	готовые шаблоны для MikroTik, единая точка управления.
	Минусы: Требует времени на настройку шаблонов для MikroTik, Elasticsearch требует тюнинга под нагрузку.
	
2. Стек: Prometheus (метрики) + Graylog (логи) + Grafana (визуализация) - это для более глубкого анализа:
	Плюсы: 
		Гибкость и кастомизация: Grafana позволяет создавать сложные дашборды с комбинацией метрик (из Prometheus) и логов (из Graylog).
		Эффективный сбор данных: Оптимизирован для сбора метрик в реальном времени, Поддерживает экспортеры для MikroTik (например, mikrotik-exporter через RouterOS API.
		Масштабируемость: Prometheus + VictoriaMetrics: Обрабатывает до 1 млн. метрик на узел (ваши 100 устройств × 50 метрик = 5K рядов — легко).
		Фильтрация и анализ логов: Потоки (Streams) для группировки логов по устройствам, туннелям L2TP, алерты при критических событиях.
		Интеграции: Prometheus Alertmanager + Graylog: Единые алерты на метрики и логи (Slack/Telegram), Grafana Loki: Альтернатива для логов, если Elasticsearch слишком тяжел.
		Open-source: Бесплатно для базового функционала, активное комьюнити.
	Минусы:
		Сложность настройки
		Ресурсоёмкость
		Отсутствие "из коробки" поддержки MikroTik
		Мониторинг L2TP-туннелей: Статус туннелей нельзя получить через SNMP — только через RouterOS API (требует отдельного экспортера).
		Визуализация топологии: Нет автоматической карты сети (как в The Dude или Zabbix).
		
		d
		fd
d
fd
fd
fdfd
d
dfd
dd
dd
d
d
d
dd
d
d
dd
d
d
d
d
d
d
d
d
d
dd
d

d
d
d
d
d
По итогу:
	Самым оптимальным вариантом для нас остаётся использовать стек: Zabbix + ELK + Grafana, почему?
	Zabbix решает проблему мониторинга 100+ устройств "из коробки".
		С помощью zabbix-proxy можно распределить нагрузку от основного сервера, может локально хранить(собранные данные буферизируются на прокси-сервере в собственной базе данных (SQLite, MySQL или PostgreSQL), если связь с основным сервером прервется, прокси продолжит собирать данные, и после восстановления соединения отправит их на сервер, эффективное мониторинг в филиалах, удаленных офисах или сетях с ненадежным соединением.
	ELK дает продвинутую фильтрацию логов (уровни, группы, туннели).
	Grafana объединяет метрики и логи в едином интерфейсе.
	Готовые решения под MikroTik экономят 80% времени на настройку.

	1. Автоматизация мониторинга
		Zabbix автообнаружит все 100 hAP ac² через сеть:  
			# Автосканирование подсети: zabbix_get -s 192.168.1.0/24 -p 161 --snmp-version 2c -c public
		Low-Level Discovery (LLD) автоматически найдет: Все L2TP-туннели, интерфейсы, QoS, Wi-Fi SSID;
	2. Централизованные логи в ELK
		MikroTik отправляет логи в Logstash:
		Фильтрация по уровню в Kibana
	3. Готовые шаблоны для MikroTik
	4. Триггеры и алертинг
	5. Единая визуализация в Grafana:
		Дашборд объединяет:
			График загрузки CPU (из Zabbix).
			Таблицу активных L2TP-туннелей (из Zabbix API).
			Логи ошибок с hAP (из Elasticsearch).
			
Реализация:
	1.Установить Zabbix-server(требования: 4vCPU, 8 GB RAM, 100 GB SSD), настроить автообнаружение устройств в подсети, импортировать шаблоны Mikrotik.
	2. ELK : можно упростить установку через Docker: 
		docker-compose up -d elasticsearch logstash kibana
	   Настроить Logstash на прием syslog (порт 514).
	   	/system logging action set name=elk target=remote remote=logstash-ip:514
		/system logging add topics=firewall,l2tp,error action=elk
	3. Grafana: подключить Zabbix / Elasticsearch через плагины, импортировать дашборд (mikrotik + zabbix)	
	
	
Рекомендация: можно сначала развернуть zabbix + grafana, добавить ELK когда понадобтся углубленный анализ логов. Для нашей сети это оптимальный баланс функциональности и сложности.